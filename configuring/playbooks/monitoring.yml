- name: Create monitoring namespace
  hosts: cluster
  tasks:
    - name: Create monitoring namespace
      ansible.builtin.shell: |
        minikube kubectl -- create namespace monitoring --dry-run=client -o yaml | minikube kubectl -- apply -f -
      register: namespace_result
      changed_when: "'created' in namespace_result.stdout or 'configured' in namespace_result.stdout or 'namespace/monitoring created' in namespace_result.stdout"

- name: Install Prometheus
  hosts: cluster
  roles:
    - prometheus

- name: Install Grafana
  hosts: cluster
  roles:
    - grafana

- name: Install Filebeat
  hosts: cluster
  roles:
    - filebeat

- name: Install Logstash
  hosts: cluster
  roles:
    - logstash
