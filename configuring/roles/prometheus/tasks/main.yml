---
- name: Get Minikube IP address
  ansible.builtin.command: minikube ip
  register: minikube_ip
  changed_when: false

- name: Apply Prometheus deployment
  kubernetes.core.k8s:
    state: present
    template: templates/prometheus.k8s.yml.j2
    namespace: monitoring
  environment:
    K8S_AUTH_KUBECONFIG: "{{ ansible_facts.user_dir }}/.kube/config"
    K8S_AUTH_CONTEXT: minikube
